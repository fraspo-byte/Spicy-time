<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Spicy Time Premium</title>
    <style>
        :root { --cyan: #70f3ff; --purple: #8e44ad; --accent: #ff2d55; --glass: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: #0d0b1a; color: #fff; margin: 0; height: 100vh; overflow: hidden; font-family: sans-serif; display: flex; flex-direction: column; }
        
        .top-nav { padding: 40px 20px 10px; display: grid; grid-template-columns: 80px 1fr 80px; align-items: center; }
        .app-title { font-size: 1.1rem; letter-spacing: 3px; text-transform: uppercase; text-align: center; font-weight: 900; color: #fff; }
        #cloud-dot { width: 10px; height: 10px; border-radius: 50%; background: #444; justify-self: center; }

        .view { display: none; flex-direction: column; flex-grow: 1; padding: 0 20px; }
        .view.active { display: flex; }

        #card-stack { position: relative; flex-grow: 1; display: flex; align-items: center; justify-content: center; margin: 15px 0; }
        .main-card { 
            position: absolute; width: 92%; height: 85%; max-height: 500px;
            background: #fff; color: #111; border-radius: 40px; 
            display: flex; flex-direction: column; padding: 25px; text-align: center; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .card-txt { font-size: 1.25rem; font-weight: 800; line-height: 1.4; margin-bottom: 20px; }
        
        /* Box immagine: arrotondato e sotto il testo */
        .card-img-box {
            width: 100%; flex-grow: 1; background: #f0f0f0; 
            border-radius: 30px; overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        .card-img-content { width: 100%; height: 100%; object-fit: contain; }

        .btn-action { 
            width: 100%; padding: 20px; border-radius: 25px; border: 2px solid var(--cyan); 
            font-weight: 900; background: rgba(112, 243, 255, 0.05); color: var(--cyan); 
            margin-bottom: 35px; cursor: pointer;
        }

        #timer-ui { display: none; margin-bottom: 10px; background: rgba(0,0,0,0.8); padding: 10px 25px; border-radius: 40px; align-self: center; color: var(--cyan); font-family: monospace; font-size: 1.5rem; }
    </style>
</head>
<body>

    <div class="top-nav">
        <div style="width:80px"></div>
        <div class="app-title">Spicy Time</div>
        <div id="cloud-dot"></div>
    </div>

    <div id="view-home" class="view active">
        <button class="btn-action" onclick="openView('game')" style="margin-top:50px">INIZIA A GIOCARE</button>
    </div>

    <div id="view-game" class="view">
        <div style="display:flex; justify-content:center; gap:20px; margin-bottom:15px; font-weight:900;">
            <span onclick="setLvl(1)" id="l1">SOFT</span>
            <span onclick="setLvl(2)" id="l2" style="opacity:0.3">HOT</span>
            <span onclick="setLvl(3)" id="l3" style="opacity:0.3">HARD</span>
        </div>
        <div id="card-stack"><div class="main-card"><h1>ðŸŽ²</h1><p>PESCA</p></div></div>
        <div id="timer-ui">00:00</div>
        <button class="btn-action" onclick="generateChallenge()">PROSSIMA SFIDA</button>
    </div>

    <script>
        // METTI IL NUOVO URL QUI
        const CLOUD_URL = "INCOLLA_QUI_IL_NUOVO_URL_DISTRIBUZIONE";
        const players = ["Eva", "Francesco"];
        let db = { 1: [], 2: [], 3: [] }, decks = { 1: [], 2: [], 3: [] }, curLvl = 1;

        async function syncDB() {
            try {
                const res = await fetch(`${CLOUD_URL}?t=${Date.now()}`);
                const data = await res.json();
                db = { 1: [], 2: [], 3: [] };
                data.forEach(item => {
                    if(db[item.livello]) db[item.livello].push(item);
                });
                document.getElementById('cloud-dot').style.background = "#00ff00";
            } catch (e) { document.getElementById('cloud-dot').style.background = "#ff0000"; }
        }

        function generateChallenge() {
            if (decks[curLvl].length === 0) decks[curLvl] = [...db[curLvl]].sort(() => Math.random() - 0.5);
            if (decks[curLvl].length === 0) return alert("Mazzo vuoto!");

            const item = decks[curLvl].pop();
            const p = [...players].sort(() => Math.random() - 0.5);
            const txt = item.testo.replace(/@A/g, p[0]).replace(/@B/g, p[1]);

            const container = document.getElementById('card-stack');
            const card = document.createElement('div');
            card.className = 'main-card';

            let imgHtml = "";
            if (item.immagine && item.immagine.length > 3) {
                let src = item.immagine;
                if (!src.startsWith('http')) {
                    // Costruisce il link per GitHub Pages
                    src = window.location.href.split('index.html')[0] + src;
                }
                imgHtml = `<div class="card-img-box"><img src="${src}" class="card-img-content"></div>`;
            }

            card.innerHTML = `<div class="card-txt">${txt}</div>${imgHtml}`;
            container.appendChild(card);
            if(container.children.length > 5) container.removeChild(container.children[0]);
        }

        function setLvl(l) { 
            curLvl = l; 
            [1,2,3].forEach(n => document.getElementById('l'+n).style.opacity = n==l ? '1' : '0.3');
        }

        function openView(id) { 
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active')); 
            document.getElementById('view-'+id).classList.add('active'); 
        }

        syncDB();
    </script>
</body>
</html>